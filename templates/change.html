{% extends 'base.html' %}

{% block content %}
<style>
    div {
        margin: 0;
        padding: 0;
    }
</style>

{# Create a dictionary with categories and their respective friendly names. #}
{% set categories = {
    "additions": "New Addition",
    "major_version_changes": "Major Change",
    "minor_version_changes": "Minor Change",
    "other_version_changes": "Other Change",
    "patches": "Patch",
    "revocations": "Revocation",
    "deprecations": "Deprecation",
    "deletions": "Deletion"
} %}

<a href="{{ url_for('upgrade', from_version=change.from_version, to_version=change.to_version) }}">‚Üê Go back to overview</a>
<div class="center">
    <h1>{{ categories[change.change_category] }}</h1>
    <h2 class="center">{{ change.mitre_id }} - {{ change.technique_name }}</h2>
    <br>
    <a href="{{ prev_change }}" class="btn btn-secondary">Previous</a>
    <button id="diff-button" class="btn btn-primary">Show Diff</button>
    <a href="{{ next_change }}" class="btn btn-secondary">Next</a>
    <br><br>
    <h3>Status:</h3>
    <div>
        <select class="status-select" data-mitre="{{ change.mitre_id }}" style="vertical-align: middle; margin-right: 10px;">
            <option {% if change.status == 'Not Done' %} selected {% endif %}>Not Done</option>
            <option {% if change.status == 'In Progress' %} selected {% endif %}>In Progress</option>
            <option {% if change.status == 'Done' %} selected {% endif %}>Done</option>
        </select>
        {% set mitre_id = change.mitre_id | replace('.', '-') %}
        {% set icon_class = "bi-check" if change.status == 'Done' else "bi-hourglass-split" if change.status == 'In Progress' else "bi-ban" %}
        {% set color = "text-success" if change.status == 'Done' else "text-warning" if change.status == 'In Progress' else "text-danger" %}
        <i id="icon-{{ mitre_id }}" class="bi {{ icon_class }} {{ color }} fs-3" style="vertical-align: middle;"></i>
    </div>
</div>
<div class="container" style="white-space: wrap; padding-top: 75px;">
    <div class="row">
        <div class="col-sm">
            <h1>Old Description</h1>
            <div id="old-description">
                {{ change.old_description | markdown | safe }}
            </div>
            
        </div>
        <div class="col-sm">
            <h1>New Description</h1>
            <div id="new-description">
                {{ change.new_description | markdown | safe }}
            </div>
        </div>
    </div>
</div>
<script>
    // Activates the diff button.
    setEventListenerDiffButton();

    // from_version -> to_version specifies the current upgrade. It's needed by the DB to make the necessary changes.
    // tojson wraps everything around quotation marks.
    const url = {{ url_for('change_status') | tojson }};
    const from_version = {{ change.from_version | tojson }};
    const to_version = {{ change.to_version | tojson }};
    setEventListenerStatusSelect(url, from_version, to_version);
</script>
{% endblock %}